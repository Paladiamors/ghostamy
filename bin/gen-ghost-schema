#!/usr/bin/env python3
###############################################################################
# Copyright (C) 2021, created on December 03, 2021
# Written by Justin Ho
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3 as published by
# the Free Software Foundation.
#
# This source code is distributed in the hope that it will be useful and
# without warranty or implied warranty of merchantability or fitness for a
# particular purpose.
###############################################################################

# when running this script, mysql libraries need to be installed, this can be done by the following:
# sudo apt-get install libmysqlclient-dev

import os
import json
import subprocess


base_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))


def read_credentials(path=os.path.join(base_dir, "credentials.json")):
    with open(path) as f:
        return json.load(f)


def gen_ghost_schema():
    credentials = read_credentials()
    cwd = os.path.join(base_dir, "ghostdb")
    conn_string = "mysql://%(username)s:%(password)s@%(host)s/%(dbname)s" % credentials
    subprocess.run(["sqlacodegen", conn_string, "--outfile", "schema.py"], cwd=cwd)


if __name__ == "__main__":
    gen_ghost_schema()
